# Spark Configuration for Airflow Environment
# Optimized for containerized deployment

# Basic Configuration
spark.master                     spark://spark-master:7077
spark.app.name                   DivvyBikes_Airflow_Extraction

# Python Configuration - CRITICAL for fixing the error
spark.pyspark.python             /opt/bitnami/python/bin/python3
spark.pyspark.driver.python      /home/airflow/.local/bin/python3
spark.executorEnv.PYSPARK_PYTHON /opt/bitnami/python/bin/python3
spark.python.worker.memory       1g
spark.python.worker.reuse        true

# Serialization Configuration
spark.serializer                 org.apache.spark.serializer.KryoSerializer
spark.kryo.registrationRequired  false
spark.kryo.unsafe                true

# Network Configuration
spark.network.timeout            800s
spark.rpc.askTimeout            800s
spark.rpc.lookupTimeout         800s

# Memory Configuration
spark.driver.memory              2g
spark.driver.maxResultSize       2g
spark.executor.memory            2g

# SQL Configuration
spark.sql.adaptive.enabled       true
spark.sql.adaptive.coalescePartitions.enabled true
spark.sql.adaptive.skewJoin.enabled true

# Dynamic Allocation
spark.dynamicAllocation.enabled  false

# Logging
spark.eventLog.enabled           false

# Compatibility settings
spark.sql.adaptive.localShuffleReader.enabled true

# S3A Configuration for MinIO
spark.hadoop.fs.s3a.impl         org.apache.hadoop.fs.s3a.S3AFileSystem
spark.hadoop.fs.s3a.path.style.access true
spark.hadoop.fs.s3a.connection.ssl.enabled false
spark.hadoop.fs.s3a.aws.credentials.provider org.apache.hadoop.fs.s3a.SimpleAWSCredentialsProvider
